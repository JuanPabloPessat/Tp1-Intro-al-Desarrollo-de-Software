<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<title>Cafejo • Inicio</title>
		<link rel="stylesheet" href="home.css" />
	</head>
	<body>
		<header>
			<div class="container-hero">
				<div class="container hero">

					<div class="customer-support">
						<i class="fa-solid fa-headset"></i>
						<div class="content-customer-support">
							<span class="text">Soporte al cliente</span>
							<span class="number">011 1234-5678</span>
						</div>
					</div>

					<div class="container-logo">
						<i class="fa-solid fa-mug-hot"></i>
						<h1 class="logo"><a onclick="redirect_home()">Cafejo</a></h1>
					</div>

					<div class="container-user" id='container-user'>
						<i class="fa-solid fa-user" id="user-icon"></i>
						<i class="fa-solid fa-basket-shopping" onclick="redirect_cart()"></i>
						<div class="content-shopping-cart">
							<span class="text" onclick="redirect_cart()">Carrito</span>
							<span class="number contador-productos" id="cart_cont"></span>
						</div>
					</div>

				</div>
			</div>
		
			<div class="container-navbar">
				<nav class="navbar container">

					<ul class="menu">
						<li><a onclick="redirect_home()">Inicio</a></li>
						<li><a onclick="redirect_products()">Productos</a></li>
						<li><a>Locales</a>
							<ul class="sub-menu">
								<li><a target="blank" href="https://www.google.com/maps/place/Av.+Paseo+Col%C3%B3n+850,+Cdad.+Aut%C3%B3noma+de+Buenos+Aires/@-34.6175515,-58.3682068,17z/data=!3m1!4b1!4m6!3m5!1s0x95a334d46ec44845:0x3eb89db">Sede Paseo Colón</a></li>
								<li><a target="blank" href="https://www.google.com/maps/place/Av.+Gral.+Las+Heras+2214,+C1126+Cdad.+Aut%C3%B3noma+de+Buenos+Aires/@-34.5885454,-58.3988167,17z/data=!3m1!4b1!4m6!3m5!1s0x95bcca98ed84925f:0x39913f4d2ce53e60!8m2!3d-34.5885498!4d-58.3962364!16s%2Fg%2F11g23543fx?entry=ttu">Sede Las Heras</a></li>
								<li><a target="blank" href="https://www.google.com/maps/place/Av.+Int.+G%C3%BCiraldes+2160,+C1428+Cdad.+Aut%C3%B3noma+de+Buenos+Aires/@-34.5452696,-58.4414307,17z/data=!3m1!4b1!4m6!3m5!1s0x95bcb448151cbff5:0x1686d8903485aaf3!8m2!3d-34.545274!4d-58.4388504!16s%2Fg%2F11ggzb96l2?entry=ttu">Sede Ciudad Universitaria</a></li>
							</ul>
						</li>
					</ul>

					<form class="search-form">
						<input type="search" placeholder="Buscar..." />
						<button class="btn-search">
							<i class="fa-solid fa-magnifying-glass"></i>
						</button>
					</form>
				</nav>
			</div>
		</header>

		<section class="banner">
			<div class="content-banner">
				<p>Café Delicioso</p>
				<h2>100% Natural <br />Café de Especialidad</h2>
				<a href="#productos">Comprar ahora</a>
			</div>
		</section>

		<main class="main-content">
			<section class="container container-features">

				<div class="card-feature">
					<i class="fa-solid fa-truck"></i>
					<div class="feature-content">
						<span>Envío gratuito a todo Bs As</span>
						<p>Desde todas nuestras sucursales</p>
						<p>En pedido superior a $10.000</p>
					</div>
				</div>

				<div class="card-feature">
					<i class="fa-solid fa-wallet"></i>
					<div class="feature-content">
						<span>Contrareembolso</span>
						<p>100% garantía de devolución de dinero</p>
					</div>
				</div>

				<div class="card-feature">
					<i class="fa-solid fa-gift"></i>
					<div class="feature-content">
						<span>Tarjeta regalo especial</span>
						<p>Ofrece bonos especiales con regalo</p>
					</div>
				</div>

				<div class="card-feature">
					<i class="fa-solid fa-headset"></i>
					<div class="feature-content">
						<span>Servicio al cliente 24/7</span>
						<p>LLámenos 24/7 al 011 1234-5678</p>
					</div>
				</div>

			</section>

			<section class="container top-categories" id = "Cafes a la venta">
				<h1 class="heading-1">Mejores Categorías</h1>
				<div class="container-categories">
					<div class="card-category category-moca">
						<p>Café moca</p>
						<span onclick="redirect_products()">Ver más</span>
					</div>
					<div class="card-category category-expreso">
						<p>Expreso Americano</p>
						<span onclick="redirect_products()">Ver más</span>
					</div>
					<div class="card-category category-capuchino">
						<p>Capuchino</p>
						<span onclick="redirect_products()">Ver más</span>
					</div>
				</div>
			</section>

			
			<section class="container top-products">
				<h1 class="heading-1">Mejores Productos</h1>
				<div class="container-products" id = "container_featured_products">
					
				</div>
			</section>


			<section class="gallery">
				<img
					src="img/gallery1.jpg"
					alt="Gallery Img1"
					class="gallery-img-1"
				/><img
					src="img/gallery2.jpg"
					alt="Gallery Img2"
					class="gallery-img-2"
				/><img
					src="img/gallery3.jpg"
					alt="Gallery Img3"
					class="gallery-img-3"
				/><img
					src="img/gallery4.jpg"
					alt="Gallery Img4"
					class="gallery-img-4"
				/><img
					src="img/gallery5.jpg"
					alt="Gallery Img5"
					class="gallery-img-5"
				/>
			</section>

			<section class="container specials">
				<h1 class="heading-1" id='productos'>En Venta</h1>
				<div class="container-products" id = "container_onsale_products">
					
				</div>
			</section>

		</main>

		<footer class="footer">
			<div class="container container-footer">
				<div class="menu-footer">
					<div class="contact-info">
						<p class="title-footer">Información de Contacto</p>
						<ul>
							<li>Teléfono: 011-12345-6789</li>
                        	<li>Email: cafejo@fi.uba.com</li>
						</ul>
						<div class="social-icons">
							<span class="facebook">
								<i class="fa-brands fa-facebook-f"></i>
							</span>
							<span class="twitter">
								<i class="fa-brands fa-twitter"></i>
							</span>
							<span class="youtube">
								<i class="fa-brands fa-youtube"></i>
							</span>
							<span class="pinterest">
								<i class="fa-brands fa-pinterest-p"></i>
							</span>
							<span class="instagram">
								<i class="fa-brands fa-instagram"></i>
							</span>
						</div>
					</div>
				</div>
				<div class="copyright">
					<p>
						Desarrollado por Alumnos de FIUBA
					</p>
					<img src="img/payment.png" alt="Pagos">
				</div>
			</div>
		</footer>
		
		<script>
			document.addEventListener('DOMContentLoaded', () => {
            const searchForm = document.querySelector('.search-form');
            const searchInput = searchForm.querySelector('input[type="search"]');
            const searchButton = searchForm.querySelector('.btn-search');

            let isExpanded = false;

            searchForm.addEventListener('submit', (e) => {
                if (searchInput.value.trim() === '') {
                e.preventDefault();
                if (isExpanded) {
                    collapseSearchBar();
                } else {
                    expandSearchBar();
                }
                }
            });

            searchButton.addEventListener('click', (e) => {
                if (!isExpanded) {
                e.preventDefault();
                expandSearchBar();
                }
            });

            searchInput.addEventListener('blur', () => {
                if (searchInput.value.trim() === '' && !searchForm.matches(':hover')) {
                collapseSearchBar();
                }
            });

            function expandSearchBar() {
                searchForm.style.width = '300px';
                searchInput.style.width = '250px';
                searchInput.style.padding = '0 1rem';
                searchInput.focus();
                isExpanded = true;
            }

            function collapseSearchBar() {
                searchForm.style.width = '4.4rem';
                searchInput.style.width = '0';
                searchInput.style.padding = '0';
                isExpanded = false;
            }

            collapseSearchBar();
            });
		</script>

		<script
			src="https://kit.fontawesome.com/81581fb069.js"
			crossorigin="anonymous"
		></script>

		<script>
			
			let Params_string = window.location.search;
			let Params = new URLSearchParams(Params_string);
			let id = Params.get('id');


			function redirect_products() {
				document.getElementById('productos').scrollIntoView({behavior: 'smooth'});
			}

			function redirect_home(){
			    if (id != null){
			        let Params_string = window.location.search;
			        let Params = new URLSearchParams(Params_string);
			        let id = Params.get('id');
			        console.log(id)
			        window.location.href = '/?id=' + id;
			    }
			    else{
			    	window.location.href = '/';
			    }
	      	}

			function redirect_login(){
				if(id == null){
					window.location.href = '/user/login'
				}
			}

			function redirect_cart(){
				let Params_string = window.location.search;
				let Params = new URLSearchParams(Params_string);
				let id = Params.get('id');
				if (id != null){
					window.location.href = '/user/cart?id=' + id;
				}
				else{
					alert("Debe estar logueado para ingresar a su carrito")
				}
			}
			cart()
			function cart(){
				let Params_string = window.location.search;
			    let Params = new URLSearchParams(Params_string);
			    let id = Params.get('id');

				function cart_amount(content){
					let products_amount = content.products_amount
					let current_amount = parseInt(cart_cont.textContent)
					let new_amount = products_amount
					cart_cont.textContent = new_amount
				}

				if(id != null){

					fetch("http://localhost:5000/user/cart/products_amount", {
							method: "POST",
							headers: {
								"Content-Type": "application/json"
							},
							body: JSON.stringify({ 
								user_id : id
							})
						})
							.then((res) => res.json())
							.then(cart_amount)
							.catch((error) => console.log("ERROR", error))
				}
			}

			

			let user_button = document.getElementById("user-icon");
			if (id != null){
				user_button.setAttribute("onclick", "redirect_cart()");
			}
			else {
				user_button.setAttribute("onclick", "redirect_login()");
			}


			function response_received(response) {
				return response.json()
			}
	
			function parse_data(content) {
				console.log("TENGO LA LISTA DE PERSONAJES!")
				console.log(content)
				let Params_string = window.location.search;
				let Params = new URLSearchParams(Params_string);
				let id = Params.get('id');
				
				//PRODUCTOS DESTACADOS
				let container_featured = document.getElementById('container_featured_products');
				for (let index = 0; index < 4; index++) {
					let product_card = document.createElement("div");
					product_card.setAttribute("class", "card-product");
					product_card.setAttribute("id",index+1)
		  
	
					let item = document.createElement("div");
					item.setAttribute("class", "container-img");
	
					let image = document.createElement("img");
					image.setAttribute("src", content[index].image);	
	
					item.append(image)            
					product_card.append(item)
	
	
	
					let product = document.createElement("div");
					product.setAttribute("class", "content-card-product");
	
					let name = document.createElement("h3");
					name.innerText = content[index].name;

					let buy_button = document.createElement("span");
					buy_button.setAttribute("class", "add-cart");
					if (id != null){
						buy_button.addEventListener("click",function(){
							product_id = product_card.id;
							console.log(product_id);
							let current_amount = parseInt(cart_cont.textContent)
							let new_amount = current_amount + 1
							cart_cont.textContent = new_amount

							function handle_response(response_json){
            					if (response_json.success) {
                					console.log("Exito")
            					} else {
                					alert("Error");
            					}
          					}

							fetch("http://localhost:5000/user/cart", {
								method: "POST",
								headers: {
									"Content-Type": "application/json"
								},
								body: JSON.stringify({ 
									product_id: product_id,
									cart_id: id
								})
							})
								.then((res) => res.json())
								.then(handle_response)
								.catch((error) => console.log("ERROR", error))
						})
					}
					else{
						buy_button.addEventListener("click",function(){
							alert("Debes iniciar sesión para agregar al carrito.")
						})
					}
					cart = document.createElement("i");
					cart.setAttribute("class", "fa-solid fa-basket-shopping");
					buy_button.append(cart);
	
					let price = document.createElement("p");
					price.setAttribute("class", "price");
					price.innerText = `$${content[index].price}`
	
					product.append(name);
					product.append(buy_button);
					product.append(price);
	
					product_card.append(product)
	
	
	
					container_featured.append(product_card);
				}


				//PRODUCTOS EN VENTA
				container_onsale = document.getElementById('container_onsale_products');
				for (let index = 0; index < content.length; index++) {
					let product_card = document.createElement("div");
					product_card.setAttribute("class", "card-product");
					product_card.setAttribute("id",index+1)
			

					let item = document.createElement("div");
					item.setAttribute("class", "container-img");
	
					let image = document.createElement("img");
					image.setAttribute("src", content[index].image);	
		
					item.append(image)            
					product_card.append(item)
		
		
		
					let product = document.createElement("div");
					product.setAttribute("class", "content-card-product");
		
					let name = document.createElement("h3");
					name.innerText = content[index].name;
	
					let buy_button = document.createElement("span");
					buy_button.setAttribute("class", "add-cart")
					let cart_cont = document.getElementById("cart_cont");
					let current_amount= parseInt(cart_cont.textContent)
					if (id != null){
						buy_button.addEventListener("click",function(){
							product_id = product_card.id
							let current_amount = parseInt(cart_cont.textContent)
							let new_amount = current_amount + 1
							cart_cont.textContent = new_amount

							function handle_response(){

							}

							fetch("http://localhost:5000/user/cart", {
								method: "POST",
								headers: {
									"Content-Type": "application/json"
								},
								body: JSON.stringify({ 
									product_id: product_id,
									cart_id: id
								})
							})
								.then((res) => res.json())
								.then(handle_response)
								.catch((error) => console.log("ERROR", error))
						})
					}
					cart = document.createElement("i");
					cart.setAttribute("class", "fa-solid fa-basket-shopping");
					buy_button.append(cart);
		
					let price = document.createElement("p");
					price.setAttribute("class", "price");
					price.innerText = `$${content[index].price}`
		
					product.append(name);
					product.append(buy_button);
					product.append(price);
		
					product_card.append(product)
			
		

					container_onsale.append(product_card);
				}
			}
	
				function request_error(error) {
					console.log("ERROR")
					console.log(error);
				}

	
				fetch("http://localhost:5000/products")
				.then(response_received)
				.then(parse_data)
				.catch(request_error)


				if (id != null){
					function response_received_2(response){
						return response.json();
					}

					function show_user_name(content){
						let name = content.name;
						console.log(name);

						let container = document.getElementById('container-user');
						let name_element = document.createElement('h1');
						name_element.setAttribute("class", "name");
						name_element.innerText = name;

						container.insertBefore(name_element, container.firstChild);
					}

					function request_error_2(error){
						alert(error)
					}

					fetch(`http://localhost:5000/user/${id}`)
					.then(response_received_2)
					.then(show_user_name)
					.catch(request_error_2)
				}
		
	
		</script>
		 
	</body>
</html>